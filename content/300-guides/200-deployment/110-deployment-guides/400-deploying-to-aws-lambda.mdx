---
title: 'Deploy to AWS Lambda'
metaTitle: 'Deploy to AWS Lambda'
metaDescription: 'Learn how to deploy Node.js and TypeScript applications based on Prisma Client to AWS Lambda.'
---

<TopBlock>

This guide explains how to set up and deploy a serverless Node.js REST API to [AWS Lambda](https://aws.amazon.com/lambda/) with the [Serverless Framework](https://www.serverless.com/framework/).

AWS Lambda is part of the AWS cloud platform. You can use it to run your code in a serverless environment. To deploy a REST API to AWS Lambda, you must also use [S3](https://aws.amazon.com/s3/) to host the files and [API Gateway](https://aws.amazon.com/api-gateway/) to expose the API over HTTP.

The Serverless Framework simplifies deployment to Lambda. It provides a CLI that helps with workflow automation and AWS resource provisioning.

This guide uses the [Prisma AWS example](https://github.com/prisma/prisma-examples/tree/latest/deployment-platforms/aws-lambda), which has example REST endpoints preconfigured as serverless functions. The Prisma AWS example uses Prisma Client to fetch, create, and delete records from a database. Each function represents a REST resource endpoint and uses Prisma Client to handle database operations against a PostgreSQL database. In this guide, we explain how to host your database on Supabase, but you can use a platform of your choice.

<Admonition type="info">

** If you deploy GraphQL servers to AWS Lambda **

This example uses REST, but the same principles apply to a GraphQL server.<br /><br />The main difference is that you typically only need a single function to serve a
GraphQL API. In that function, set the `context.callbackWaitsForEmptyEventLoop` of the [AWS Lambda Context Object](https://docs.aws.amazon.com/lambda/latest/dg/nodejs-context.html) to `false` as follows:

```js
exports.server = (event, context, cb) => {
  // Set to false to send the response right away when
  // the callback executes. Don't wait for the Node.js
  // event loop to be empty.
  context.callbackWaitsForEmptyEventLoop = false

  return lambda.graphqlHandler(event, context, cb)
}
```

</Admonition>

</TopBlock>

## Prerequisites

- a hosted PostgreSQL database and a URL from which your application can access it, such as `postgresql://username:password@your_postgres_db.cloud.com/db_identifier` (you can use Supabase, which offers a [free plan](https://dev.to/prisma/set-up-a-free-postgresql-database-on-supabase-to-use-with-prisma-3pk6)).
- an [AWS](https://aws.amazon.com/) account and a corresponding [access key](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html) for programmatic access.
- a [Serverless Framework CLI](https://www.serverless.com/framework/docs/getting-started/) installed.
- PostgreSQL CLI `psql` installed.
- Node.js installed.

## Prisma workflow

For this guide, you need to prepare an empty database. You can then use Prisma and a Prisma schema file (`schema.prisma`) to create a schema for the database.

After that, you use `prisma db push` to push to the database the schema you define in `schema.prisma`.

<Admonition type = "info" >

For the purposes of this guide, we use `prisma db push` to create the database. However, in a production environment you would typically use `prisma migrate dev`. For more information on when to use each method, see [this](/concepts/components/prisma-migrate/db-push#choosing-db-push-or-prisma-migrate)

</Admonition>

## 1. Download the example project

To start, download the example project. The project includes the configuration that you need to complete this guide.

### Steps

Open a terminal window and navigate to a location of your choice. Use the following commands to create a directory for the project and download the example code:

```terminal
mkdir prisma-aws-lambda
cd prisma-aws-lambda
curl https://codeload.github.com/prisma/prisma-examples/tar.gz/latest | tar -xz --strip=3 prisma-examples-latest/deployment-platforms/aws-lambda/
```

Now install the dependencies:

```terminal
npm install
```

<!-- tar strip folder is a concatenation of the REPOSITORY-BRANCH/REF, e.g. prisma-examples-latest -->

### Result

Your directory contains the following files:

```terminal no-copy
README.md
handlers
node_modules
package-lock.json
package.json
prisma
schema.sql
serverless.yml
```

## 2. Set the DATABASE_URL environment variable locally

### Steps

Set the `DATABASE_URL` environment variable locally as follows. This lets you create the database schema and ensures that Prisma can access the database.

> **Note:** If your connection URL contains any special characters, then you must [percentage encode them](/reference/database-reference/connection-urls#special-characters).

```terminal
export DATABASE_URL="postgres://__USER__:__PASSWORD__@__HOST__/__DATABASE__"
```

> **Note:** You need the `DATABASE_URL` environment variable for the subsequent steps in this guide. Set it in all terminal sessions related to this project.

Replace the uppercase placeholders with your database credentials. For example:

```terminal
postgres://janedoe:randompassword@yourpostgres.supabase.co:6543/yourdbname
```

## 3. Set the DATABASE_URL in <inlinecode>.env</inlinecode>

The Lambda functions need the `DATABASE_URL` environment variable to access the database. You must define an `.env` file. The preconfigured `serverless-dotenv-plugin` uses this file to inject into the function runtime.

The repository contains an `.env.example` example file to help with this. Enter the following command to copy `.env.example` to a new file, `.env`:

```terminal
cp .env.example .env
```

Open `.env` and set the `DATABASE_URL` to your database credentials from step 2.

> **Note:** It's best practice to keep secret information, such as `DATABASE_URL`, out of your git repository. To do this, add your `.env` file to `.gitignore`. This guide copies the source and does not create a repository, so you only need to update `.gitignore` if you initialize a repository.

## 4. Push the Prisma schema to the database

### Steps

```terminal
npx prisma db push
```

Prisma populates the database with the models that are defined in `schema.prisma`.

### Result

Use Prisma Studio to inspect your database and confirm that the tables are set up according to the schema.

Open Prisma Studio:

```terminal
npx prisma studio
```

Your database has three models: `Post`, `Profile`, and `User`.

### Generate Prisma Client

Run `prisma generate` to generate Prisma Client based on your new Prisma schema:

```terminal
npx prisma generate
```

<Admonition type = "info">

Whenever you make changes to your Prisma schema, invoke `prisma generate` to update your Prisma Client API.

</Admonition>

## 5. Set your AWS Access key as an environment variable

In order for the Serverless Framework to provision the AWS resources and deploy your application, you must configure your access key.

The method you use to get the access key depends on whether you use your personal account or create a special IAM user for the Serverless Framework. We recommend that you create a special IAM user because it lets you set granular permissions. To get an access key for your account, follow the [AWS guide](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey)

When you have the _Access key ID_ and a _Secret access key_, set them with the following command. In the following command, replace the placeholders with your _Access key ID_ and _Secret access key_.

If you installed the Serverless Framework CLI globally, then use the following command:

```terminal
serverless config credentials --provider aws --key AWS_ACCESS_KEY_ID  --secret AWS_SECRET_ACCESS_KEY
```

If you installed the Serverless Framework CLI in your project, then use the following command instead:

```terminal
npx serverless config credentials --provider aws --key AWS_ACCESS_KEY_ID  --secret AWS_SECRET_ACCESS_KEY
```

## 6. Deploy your project

You have finished the configuration, so you can now deploy your project with `serverless deploy`.

### Steps

To deploy your project, use the following command:

```terminal
serverless deploy
```

Serverless creates the AWS resources and uploads your code, then outputs the service information. For example:

```code no-copy
Service Information
service: prisma-aws-lambda-example
stage: dev
region: us-east-1
stack: prisma-aws-lambda-example-dev
resources: 39
api keys:
  None
endpoints:
  GET - https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/
  GET - https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/seed
  GET - https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/users
  POST - https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/users
  GET - https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/posts
functions:
  status: prisma-aws-lambda-example-dev-status
  seed: prisma-aws-lambda-example-dev-seed
  getUsers: prisma-aws-lambda-example-dev-getUsers
  createUser: prisma-aws-lambda-example-dev-createUser
  getPosts: prisma-aws-lambda-example-dev-getPosts
layers:
  None
```

### Result

Call the status endpoint with the following command. Replace `UNIQUE_IDENTIFIER` with the corresponding part of the URL from the output you got from `serverless deploy`.

```terminal
curl https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/
```

This returns the following:

```terminal no-copy
{"up":true}
```

## 7. Test your deployed REST API

With the API base URL `https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/`, you can test the API's endpoints:

| Endpoint      | Description                                                                                                              | Implementation            |
| ------------- | ------------------------------------------------------------------------------------------------------------------------ | ------------------------- |
| `GET /`       | Status                                                                                                                   | `handlers/status.js`      |
| `GET /seed`   | Delete all database records and seed the database with test `users`, `profiles`, and `posts`. Returns the created users. | `handlers/seed.js`        |
| `GET /users`  | Fetch all `users` in the database with their related `profiles`                                                          | `handlers/users.js`       |
| `POST /users` | Create a single `users` in the database                                                                                  | `handlers/create-user.js` |
| `GET /posts`  | Fetch all `posts` and their related `authors`                                                                            | `handlers/posts.js`       |

To call the API, you can use curl. For example, the following command calls the `seed` endpoint. Replace `UNIQUE_IDENTIFIER` with the corresponding part of the URL from the output of `serverless deploy` in step 6.

```terminal
curl -v https://UNIQUE_IDENTIFIER.execute-api.us-east-1.amazonaws.com/dev/seed
```

<Admonition type = "info">

The `serverless.yml` configuration file contains the endpoint and function configuration. You can update this file to add or change endpoints. For more AWS specific configuration information, see the AWS provider configuration in the [Serverless Framework documentation](https://serverless.com/framework/docs/providers/aws/guide/functions/).

</Admonition >

## Deploy only the required artifacts

To reduce your deployment footprint, you can change your deployment process so that you only upload the artifacts that your application needs. The method for doing so is different, depending on whether you use the Serverless Framework or not.

### If you use the Serverless Framework

You can use the Serverless configuration file to [deploy only the binary that your project needs](/guides/deployment/deployment-guides/use-prisma-with-serverless-framework#reduce-the-package-footprint).

### If you do not use the Serverless Framework

If you do not use the Serverless Framework to deploy your project, you can use the following method to remove any unneeded artifacts.

1. Create a zip script that only zips the files that your project needs. [Example script](https://github.com/prisma/ecosystem-tests/blob/dev/platforms-serverless/lambda/zip.sh).

2. Upload the zip. For example, to do this with the [AWS CLI](https://aws.amazon.com/cli/), you might use a command similar to the following:

   ```terminal
   aws lambda update-function-code --function-name my-function --zip-file "fileb://lambda.zip"
   ```

## Summary

Congratulations! You have successfully deployed the API to AWS Lambda.

For more information about how to use the Serverless Framework with Prisma projects, see [use Prisma with the Serverless Framework](/guides/deployment/deployment-guides/use-prisma-with-serverless-framework).

For more insight into Prisma Client's API, look at the function handlers in the `handlers/` folder.

<Admonition type="info">

**A note on connection pooling**<br /><br />Generally, when you use a FaaS (function as a service) environment to interact
with a database, every function invocation can result in a new connection to the
database. This is not a problem with a constantly running node.js server.
Therefore, it is beneficial to pool DB connections to get better performance.
For some solutions to this issue, see the [connection management guide for
serverless
environments](/guides/performance-and-optimization/connection-management#serverless-environments-faas).

</Admonition>
